meta:
  canvas: infra_slack_optional.md
  priority: P1  # workflow-unblocker dev környezetben
steps:
  # 1️⃣ Slack token default="" változó beállítása
  - patch_file:
      target: variables.tf
      patch: |
        @@
 variable "slack_webhook_url" {
   type        = string
   description = "Slack Bot User OAuth token (xoxb-…)"
+  default     = ""
   # Leave empty in dev to disable Slack notification channel
 }

  # 2️⃣ Notification channel feltételessé tétele
  - patch_file:
      target: infra/notification_channel.tf
      patch: |
        @@
-resource "google_monitoring_notification_channel" "slack" {
+resource "google_monitoring_notification_channel" "slack" {
+  count        = var.slack_webhook_url == "" ? 0 : 1
@@
 }

  # 3️⃣ Terraform format & validate
  - run: terraform fmt -recursive
  - run: terraform validate
