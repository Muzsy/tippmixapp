rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /* ——— SEGÉDFÜGGVÉNYEK ——— */
    function signedIn()      { return request.auth != null; }
    function isOwner(userId) { return signedIn() && request.auth.uid == userId; }

    /* ——— coin_logs ——— */
    match /coin_logs/{logId} {
      function validCoinLog() {
        return request.resource != null
          && request.resource.data != null
          && request.auth.uid == request.resource.data.userId
          && request.resource.data.amount is int
          && request.resource.data.type in ['bet','deposit','withdraw','adjust'];
      }
      allow create: if signedIn() && validCoinLog();
      allow read:   if isOwner(resource.data.userId);
      allow update, delete: if false;
    }

    /* ——— badges (publikus read) ——— */
    match /badges/{badgeId} {
      allow read:  if true;
      allow write: if false;
    }

    /* ——— notifications ——— */
    match /notifications/{userId}/n/{notifId} {
      allow create: if false;
      allow read:   if isOwner(userId);
      allow update: if isOwner(userId)
        && request.resource != null
        && request.resource.data.read == true;
      allow delete: if false;
    }
  }
}
